# DX12 CPU和GPU数据通信方式

在 DirectX 12 中，CPU 和 GPU 数据通信的方式有多种，以下是几种常见的方式：

1. 上传资源：通过 `ID3D12Resource::Map` 函数将 CPU 内存中的数据映射到 GPU 内存中的资源上。该函数返回一个指向映射后内存区域的指针，可以在指针所指内存区域中修改数据。随后通过 `ID3D12CommandList::CopyBufferRegion` 函数将内存中的数据复制到目标资源中，最后通过 `ID3D12Resource::Unmap` 函数解除资源与内存区域之间的映射。
2. 下载资源：通过 `ID3D12Resource::Map` 函数将 GPU 内存中的资源映射到 CPU 内存中的缓冲区上。该函数返回一个指向映射后内存区域的指针，可以在指针所指内存区域中读取数据。随后通过 `ID3D12CommandList::CopyBufferRegion` 函数将资源中的数据复制到缓冲区中，最后通过 `ID3D12Resource::Unmap` 函数解除资源与缓冲区之间的映射。
3. 常量缓冲区：使用常量缓冲区来传递 CPU 到 GPU 的数据。可以创建一个包含需要传递数据的结构体、变量等的缓冲区，并将其绑定到管道上。然后，在每次绘制前，可以使用 `ID3D12GraphicsCommandList::SetGraphicsRootConstantBufferView` 函数将缓冲区与根签名中的常量缓冲区绑定起来。这样，GPU 就可以在每次绘制时从绑定的常量缓冲区中读取数据。
4. 顶点缓冲区：使用顶点缓冲区来传递需要对每个顶点执行的操作或者属性值。可以创建一个包含所有顶点数据的缓冲区，并将其绑定到管道上。然后，在每次绘制前，可以使用 `ID3D12GraphicsCommandList::IASetVertexBuffers` 函数将缓冲区与输入装配阶段的顶点缓冲区绑定起来。这样，GPU 就可以在顶点着色器中访问绑定的顶点缓冲区中的数据。

总之，DX12 中的 CPU 和 GPU 数据通信非常灵活，可以根据具体应用场景选择不同的方案。上述介绍的仅是其中的一部分，还有许多其他的方式，例如贴图资源、纹理资源等等。