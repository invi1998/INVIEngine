# AO

AO是环境光遮蔽（Ambient Occlusion）的缩写。它是计算机图形学中一种用于增强场景真实感的技术。

环境光遮蔽通过考虑光线在物体表面附近的遮蔽程度来模拟间接光照的效果。在现实世界中，物体表面附近的凹陷或遮挡区域往往会因为周围的物体而较暗，而凸出或不被遮挡的区域则会相对较亮。环境光遮蔽通过计算每个像素点周围的遮蔽因子来模拟这种效果。

常见的环境光遮蔽算法包括：

1. 屏幕空间环境光遮蔽（Screen Space Ambient Occlusion，SSAO）：该算法基于屏幕空间，通过对深度、法线等信息进行采样和计算来估计遮蔽因子。由于只考虑了屏幕上可见的像素，算法比较快速，但也可能存在一些伪影和漏光的问题。

2. 全局环境光遮蔽（Global Ambient Occlusion，GAO）：该算法通过对整个场景进行光线追踪或预计算来计算遮蔽因子。相比于SSAO，GAO可以更准确地模拟光照效果，但计算成本较高。

3. 基于光线追踪的环境光遮蔽（Ray Traced Ambient Occlusion）：该算法使用光线追踪方法，对每个像素发射多条光线来计算遮蔽因子。这种方法可以提供更精确的结果，但计算成本更高。

环境光遮蔽技术能够使场景中的物体更加真实、立体，并增加阴影效果，提高视觉质量。它常被用于游戏开发、电影特效制作以及其他需要高质量渲染的应用中。



## SSAO

SSAO（Screen Space Ambient Occlusion）是一种基于屏幕空间的环境光遮蔽技术，用于增强实时渲染的场景真实感和阴影效果。

**原理：**

SSAO的原理是通过对屏幕上可见像素点周围的深度和法线信息进行采样和计算，来估计每个像素点周围的遮蔽因子。这些遮蔽因子表示了物体表面附近的阻挡程度，从而模拟了间接光照效果。

1. 法线计算：首先，在渲染过程中需要获取每个像素点的法线信息。通常使用法线贴图或屏幕空间法线重建技术从深度缓冲中计算法线。

2. 采样和计算：对于每个像素点，SSAO会在其周围随机采样一组位置，并通过将这些位置转换到视口空间，计算出对应的深度值。然后，将该深度值与当前像素点的深度进行比较，以获取遮蔽因子。

3. 遮蔽因子计算：通过计算深度值的差异来确定遮蔽因子。较小的深度差值表示较暗的遮蔽区域，较大的深度差值表示较亮的非遮蔽区域。使用一个合适的函数（如衰减函数）将深度差值转换为0到1之间的遮蔽因子。

4. 累加和平均：对于每个像素点，将多次采样得到的遮蔽因子进行累加，并求取平均值，作为最终的SSAO遮蔽因子。

5. 结合渲染：最后，将SSAO遮蔽因子与场景的颜色进行混合，以模拟阴影效果和间接光照。

**工程实践：**

在实现SSAO时，以下是一些工程实践的考虑因素：

1. 坐标空间转换：将世界空间或物体空间的法线和深度转换到屏幕空间进行计算，需要合适的变换矩阵。

2. 采样数量和质量：SSAO的效果可以通过采样点的数量和采样质量来调整。更多的采样点通常可以提供更准确的结果，但也会增加计算开销。

3. 噪声纹理：为了减少采样点的规律性，可以使用预生成的随机噪声纹理。这样可以使得每个像素点周围的采样点位置更加分散，避免产生明显的重复纹理。

4. 深度偏差：为了解决精度问题和避免自身遮挡，可以在深度采样时引入一个偏差值，使得采样点稍微靠近相机。

5. 后期处理和优化：SSAO计算完成后，可能需要进行一些后期处理和优化，例如降噪、模糊等，以获得更好的效果和性能。

6. 分辨率和性能权衡：SSAO是一个相对计算密集的技术，高采样率和高分辨率下的运行成本较高。因此，可能需要根据目标硬件和性能要求



## HBAO

HBAO（Horizon-Based Ambient Occlusion）是一种基于视锥体的环境光遮蔽技术，旨在提供高质量的实时渲染阴影和环境光效果。

**原理：**

HBAO的原理是通过近似计算场景中每个像素点周围的遮蔽因子，以模拟间接光照效果。

1. 视锥体空间重建：首先，利用投影矩阵将深度缓冲转换到视锥体空间。这可以通过对每个像素点的位置进行透视除法和逆变换来实现。

2. 水平面检测：通过分析视锥体表面的水平线与场景的交点，确定每个像素点处的水平轮廓。这有助于区分凹陷和凸出的表面。

3. 遮蔽因子计算：为了计算遮蔽因子，HBAO使用了一个基于半球的采样方法，即在每个像素点周围的指定半球上采样。采样点的位置和权重通过预计算得到，并存储在一个叫做AO纹理的贴图中。

4. AO纹理采样：在渲染过程中，根据当前像素点的位置和法线信息，从AO纹理中采样得到相应的遮蔽因子。

5. 结合渲染：最后，将得到的遮蔽因子与场景的颜色进行混合，以模拟阴影效果和间接光照。

**工程实践：**

在实现HBAO时，以下是一些工程实践的考虑因素：

1. 优化方法：由于HBAO涉及大量的纹理采样和计算，需要注意性能问题。可以使用优化技术，如降低采样率、使用半分辨率纹理、渐进式计算等，以增加效率。

2. 噪声和颜色调整：为了减少输出结果中的伪影和提高视觉质量，可以使用随机噪声纹理和颜色调整技术对HBAO进行后处理。

3. 参数调整和调试：HBAO有许多参数可以调整，如半径、强度、偏移、迭代次数等。通过仔细调整这些参数，并结合实时预览和调试工具，可以达到所需的效果。

4. 分辨率和性能权衡：HBAO的运行成本较高，特别是在高分辨率屏幕上。因此，可能需要根据目标硬件和性能要求，在分辨率和质量之间做出权衡。

5. 光照条件和环境设置：HBAO的效果受光照条件和场景设置的影响。对于不同的场景和光照条件，可能需要调整参数或使用其他技术来获得更好的效果。

综上所述，HBAO是一种基于视锥体的环境光遮蔽技术，通过近似计算每个像素点周围的遮蔽因子，以模拟间接光照效果。在实际工程中，需要关注性能优化、参数调整和光照环境等方面，以获得高质量的渲染结果。