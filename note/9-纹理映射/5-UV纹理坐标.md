# 球体模型展UV

![image-20230927141405796](.\image-20230927141405796.png)

球体模型展UV算法是一种将球体表面的纹理坐标映射到平面上的算法，用于在球体表面上正确呈现一个贴图。这个过程也被称为“球形映射”（spherical mapping）或“球形贴图”（spherical texturing），它可以通过以下步骤来实现：

1. 计算每个顶点的球面坐标

对于球体模型上的每个顶点，我们需要计算出其对应的球面坐标。一种常见的方法是使用球面坐标系（spherical coordinate system），其中一个点由三个参数组成：半径、极角和方位角。根据球体的半径和顶点在球面上的位置，我们可以计算出每个顶点的球面坐标。

2. 将球面坐标转换为UV坐标

   首先，我们知道，球坐标系和直角坐标系的转换关系如下

   1).球坐标系(r,θ,φ)与直角坐标系(x,y,z)的转换关系: 

   x=rsinθcosφ.

   y=rsinθsinφ.

   z=rcosθ.

   2).反之，直角坐标系(x,y,z)与球坐标系(r,θ,φ)的转换关系为:
   $$
   r = \sqrt{x^2 + y^2 + z^2}
   \\ \\
   \theta = \arccos{\frac{z}{r}}
   \\ \\
   \phi = \arctan{\frac{y}{x}}
   $$
   而θ是原点到点 P 的连线与正 z-轴之间的天顶角，它的范围0-π就能映射出一个球体，而对于φ，他是原点到点 P 的连线，在 xy-平面的[投影](https://baike.baidu.com/item/投影/7565?fromModule=lemma_inlink)线，与正 x-轴之间的方位角，它的范围是0-2π，就能映射出一个球体范围。

   所以球体的UV在我们知道θ和φ之后，可以这样表示：
   $$
   U = \phi / (2 * \pi)
   \\ \\
   V = \theta / \pi
   $$
   

接下来，我们需要将每个顶点的球面坐标映射到一个二维平面上，以便从贴图中获取相应的颜色值，使用公式：

```c++
u = (atan2(y, x) + PI) / (2 * PI)
v = acos(z / r) / PI
```

其中，(x,y,z)是该顶点的球面坐标，r是球的半径，PI表示圆周率。这个公式可以将球面坐标转换为一个范围为[0,1]的二维坐标，其中u和v分别代表水平和垂直方向的坐标。

3. 处理UV坐标的旋转和偏移

由于球体的表面通常不是完美的平滑曲面，而是由许多小多边形拼接而成的，因此在实际应用中，我们需要对UV坐标进行进一步处理，以保证贴图的正确呈现。一种常见的方法是在生成UV坐标时添加一定的旋转和偏移量，以便更好地匹配球体的表面。例如，在Unity游戏引擎中，使用球形映射时，可以通过调整材质属性来控制UV坐标的旋转和偏移量。

