# 折射，菲涅耳，斯涅耳

折射（Refraction）指的是当光线从一个介质传播到另一个介质时，由于介质折射率不同，使得光线方向发生改变的现象。在图形学中，折射通常用于模拟透明物体和介质内部的光学效果，如水面、玻璃等。

根据菲涅耳公式，入射角度和介质折射率的关系决定了反射和折射的比例。当入射角度很小或折射率差异较小时，大部分光线会被折射而少部分被反射；而当入射角度很大或折射率差异较大时，大部分光线会被反射而少部分被折射。

折射通常需要考虑光线与物体表面的交互作用、物体内部的材质分布以及光线在介质内的传播路径等因素。这一过程可以通过数值方法来计算和模拟，如辐射传输方程、投射纹理、物理光线追踪等技术。在计算机图形学中，折射通常用于实现弯曲、扭曲、反射等特殊效果，并且也是实现逼真的光学效果和视觉感受的重要手段之一。



## 斯涅尔（折射率公式）

斯涅尔效应（Snell's Law）是光线从一个介质传播到另一个介质时，折射角度与入射角度之间的关系。根据斯涅耳定律，光线在通过介质界面时，其入射角和折射角遵守如下的比例关系：

$\frac{\sin\theta_1}{\sin\theta_2}=\frac{n_2}{n_1}$

其中，$\theta_1$为入射角度，$\theta_2$为折射角度，$n_1$和$n_2$分别表示两个介质的折射率。该公式表示了光线在不同介质中传播时所遵循的基本物理规律，并且可以用于计算光线的传播路径和方向。

在计算机图形学中，斯涅耳效应通常用于模拟透明材质、水面、玻璃等表面的反射和折射现象。例如，在光线追踪中，可以通过斯涅耳公式来计算光线的传播路径和偏离角度，从而实现逼真的折射效果。此外，斯涅耳效应还可以与其他理论和算法相结合，如菲涅耳公式、辐射传输方程等方法，来实现复杂的光学现象和纹理映射等技术。



## 菲涅耳公式（Fresnel Equations）

菲涅耳公式（Fresnel Equations）描述了光线从一个介质传播到另一个介质时，反射和折射的比例关系。由于两种介质之间的折射率不同，入射光线会在界面上反射一部分、折射一部分，而其反射和折射比例取决于入射角度、介质折射率和极化方向等因素。

若入射光线沿着垂直于界面的法向量方向，则不存在折射现象，只有反射；而如果入射光线倾斜，则既存在反射也存在折射。此时，可以通过菲涅耳公式来计算反射光线和折射光线的强度比例，该公式表述如下：

$R_{\text{par}}=\dfrac{(n_1 \cos\theta_i - n_2 \cos\theta_t)^2}{(n_1 \cos\theta_i + n_2 \cos\theta_t)^2}$

$R_{\text{perp}}=\dfrac{(n_2 \cos\theta_i - n_1 \cos\theta_t)^2}{(n_1 \cos\theta_t + n_2 \cos\theta_i)^2}$

其中，$R_{\text{par}}$和$R_{\text{perp}}$分别表示平行和垂直于入射光线极化方向的反射光强度与入射光强度之比，$\theta_i$为入射角度，$\theta_t$为透射角度，$n_1$和$n_2$为两个介质的折射率。公式中的分子和分母都是基于反射和折射光线的强度和振动方向之间的关系所计算出来的。

在实际应用中，菲涅耳公式通常被用于计算反射和折射光线的比例，并结合其他光学理论和算法进行渲染和模拟。例如，在光线追踪中，可以通过菲涅耳公式来计算反射和折射光线的能量分配比例，从而实现逼真的镜面反射和折射效果。

在计算机图形学中，菲涅耳公式（Fresnel Equations）通常用于描述光线从一个介质传播到另一个介质时，反射和折射的比例关系。在着色器程序中，可以使用菲涅耳公式来计算光照对物体表面的影响，并实现逼真的反射和折射效果。



### shader里的菲涅尔近似公式

一种常见的菲涅耳公式实现方式是基于Schlick近似模型（Schlick Approximation），其表述如下：

$R(\theta) = R_0 + (1-R_0)(1-\cos\theta)^5 = R_0 + (1-R_0)(1-(n \cdot v))^5$

其中，$R_0$为反射率，$\theta$为入射角度（与法向量之间的夹角），$\cos\theta$为入射角度的余弦值, n是法线，v是光线入射向量。根据Schlick近似模型，这个公式的含义是，当入射角度接近垂直于物体表面时，反射率会趋近于一个最大值$R_0$，而当入射角度较大时，反射率则会逐渐减小。整个公式的意义是，随着入射角度的增加，反射光线的比例会逐渐降低，直到完全消失。这种变化方式与实际情况相符合，因此被广泛应用于各种光学效果的计算中。

在实际应用中，菲涅耳公式通常会结合其他光照和材质参数进行计算，例如环境光、漫反射、镜面反射等因素。对于不同的物体和场景，可能需要根据实际情况调整反射率和入射角度的取值范围，以达到更好的视觉效果和真实性。



