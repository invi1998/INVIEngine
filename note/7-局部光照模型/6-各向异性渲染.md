# 各向异性渲染

## 介绍

头发的渲染有很多方法，主要有分基于法线的（STRAND BASE）和基于多边形面片的（PolygonBase）。而头发的渲染其实也是各向异性的一种线像。我们会在以下章节介绍一下相关的技术基础，包括了：

- **各向异性v.s.各向同性**
- **Kajiya-Kay模型 （基于经验）**
- **Marschner's (R/RR/TRT) （基于物理）**
- **LUT Marschner's模型（基于物理，近似）**
- **Strand Based, Single Scattering & Multi Scattering模型（基于物理）**



- **基于法线**
- **基于多边形面片**

## **各向异性v.s.各向同性**

各向异性着色是在垂直于表面上的纹理或凹槽的方向上延伸反射。如果把各向异性渲染与更常见的各向同性渲染进行对比的话。各向同性渲染在所有方向上均匀地散射光，而各向异性头发在不同的方位角及跟据表面颗粒形状的纹理而改变，一般在拉丝钢，CD光盘，头发，等划痕表面产生垂直于纹理方向的高光。

![image-20230910193316037](.\image-20230910193316037.png)

这是因为在这些表面微观细看，我们会发现微观上是有一根一根的划痕的东西。

各向异性的BRDF有以下的: $f(\omega_o, \omega_i, \theta_i, \theta_o) \neq f(\omega_o - \omega_i, \theta_i, \theta_o)$

各向同性的BRDF有以下的:   $f(\omega_o, \omega_i, \theta_i, \theta_o) = f(\omega_o - \omega_i, \theta_i, \theta_o)$

## **Blinn-Phong光照模型**

Blinn-Phong光照模型是我们平常用的公式，这是一个各向同性光照模型，一般一个点的法线N是比较固定的，可以从vertex或normal map得到。光照公式如下：

$I_{s blinnPhong} = L_i * k_s (\vec{N} \cdot \vec{H})^n$ ，其中

- $I_s$ 是高光强度
- $L_i$ 是入射光强度
- $K_s$ 是高光反射率
- $\vec{N}$ 是法线方向
- $\vec{H}$是中线方向
- $n$ 是光滑度

使用Blinn-Phong光照，我们可以看到一个椭圆形的高光亮点，但是无法模拟各向异性的拉丝钢，头发等环状高光效果。

![image-20230910194041535](.\image-20230910194041535.png)

## 各向异性光照模型

![image-20230910194133214](.\image-20230910194133214.png)

各向异性光照表面微观细看，会发现有一根一根的划痕的东西。这个表面的一个点可能有多个法线。所以法线N不是唯一的，我们不能用N来判断表面方向。反而切线T是我们要关注的。各向异性光照是使用L及T来算光照的。

![image-20230910194205456](.\image-20230910194205456.png)

如之前的L是入射光方向，T是切线，我们可以用T和L的平面来确定唯一的一条于T和L公面的法线 $N_c$ 。光照可以如下公式得到：
$$
\vec{N_c} \cdot \vec{L} = \cos{\theta} = \sin{(\frac{\pi}{2} - \theta)} = \sqrt{1-\cos{^2(\frac{\pi}{2} - \theta)}} = \sqrt{1-(\vec{T} \cdot \vec{L})^2} 
$$


同一原因, 因为L只是一个符号，我们可以用H代入 L
$$
\vec{N_c} \cdot \vec{H} = \sqrt{1- (\vec{T} \cdot \vec{H})^2}
$$


现在我们确定了 $\vec{N_c} \cdot \vec{H}$，我们的各向异性光照是怎么呢。

如Blinn-Phong一样，我们只需要代入  $\vec{N_c} \cdot \vec{H}$
$$
I_{s anisotopoc} = L_i * k_s (\vec{N_c} \cdot \vec{H})^2
\\
= L_i * k_s * (\sqrt{1-(\vec{T} \cdot \vec{H})^2})^n
$$


![image-20230910195314263](.\image-20230910195314263.png)