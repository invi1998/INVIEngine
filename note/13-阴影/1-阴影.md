# DX12阴影渲染原理

在 DirectX 12 中，阴影渲染通常采用阴影映射（Shadow Mapping）技术来实现。这种技术的基本原理是，从光源的视角渲染场景，并将深度信息存储到一个纹理中。然后，在场景的正常渲染过程中，使用这个深度纹理对像素进行测试，判断它们是否处于阴影之中。

下面是阴影映射的基本流程：

1. 从光源的视角渲染场景，生成深度纹理。

   在这一步中，需要使用光源的位置和方向来构建一个摄像机矩阵，并使用这个矩阵渲染场景。由于只需要深度信息，因此通常使用简单的顶点着色器和深度测试来渲染场景。

2. 将深度纹理传递给场景的渲染过程。

   在场景的正常渲染过程中，需要将深度纹理作为一个参数传递给着色器。可以通过常量缓冲区、纹理或者 UAV 等方式来实现。

3. 对每个像素进行深度测试，判断它是否处于阴影之中。

   在着色器中，需要将当前像素的位置转换到光源的坐标系中，并从深度纹理中获取对应位置的深度值。然后，将当前像素的深度值与从深度纹理中获取的深度值进行比较，如果当前像素的深度值小于深度纹理中的深度值，则说明该像素处于阴影之中。

4. 根据阴影状态对像素进行着色。

   如果当前像素处于阴影之中，那么就需要使用一个较暗的颜色来对其进行着色，以模拟阴影的效果。通常使用 Ambient Occlusion（环境光遮蔽）等技术来增强阴影的效果。

需要注意的是，阴影映射会产生一些锯齿和阴影失真的问题，需要通过一些技术来解决。例如，可以通过使用 PCF（Percentage Closer Filtering）算法来减少锯齿的出现，或者使用 Variance Shadow Maps（VSM）等技术来提高阴影的精度。



正交投影

![image-20231208160958077](.\image-20231208160958077.png)

























