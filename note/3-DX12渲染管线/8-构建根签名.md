# 构建根签名

根签名（Root Signature）是 Direct3D 12 渲染管线中的一个非常重要的概念，用于描述着色器程序所需的资源以及访问这些资源的方式。构建根签名是 Direct3D 12 渲染管线中的第一步，它定义了着色器需要的资源、根参数等信息，然后在管线状态对象中绑定，以供 GPU 使用。

Direct3D 12 提供了多种方式来构建根签名，包括使用 D3D12_ROOT_SIGNATURE_DESC 结构体、使用 ID3D12VersionedRootSignatureDeserializer 接口和使用 ID3D12RootSignatureDeserializer 接口等。下面介绍一下如何使用 D3D12_ROOT_SIGNATURE_DESC 结构体来构建根签名。

创建根签名主要分为以下几个步骤：

1. 定义根参数

根参数（Root Parameter）是指向根签名条目的指针，每个根参数描述了着色器程序所需的单个资源或常量缓冲区等信息。可以使用 D3D12_ROOT_PARAMETER 结构体来描述根参数，其中包含如下字段：

- ParameterType：指定根参数的类型，包括常量缓冲区（CBV）、着色器资源视图（SRV）、无序访问纹理（UAV）、根常量（32 位整数值）等。
- ShaderVisibility：指定根参数在哪些着色器程序阶段可见，包括顶点着色器（VS）、像素着色器（PS）、几何着色器（GS）、外壳着色器（HS）、域着色器（DS）和计算着色器（CS）等。
- Descriptor：用于描述 CBV、SRV 和 UAV 类型的根参数，包括描述符寄存器范围（DescriptorTable）、描述符范围（Constants）、描述符表（Descriptor）等。
- Constants：用于描述根常量类型的根参数，包括常量数据的地址和大小等信息。

例如，下面的代码定义了一个根参数，表示一个常量缓冲区：

```c++
// 定义常量缓冲区根参数
D3D12_ROOT_PARAMETER rootParam = {};
rootParam.ParameterType = D3D12_ROOT_PARAMETER_TYPE_CBV;
rootParam.ShaderVisibility = D3D12_SHADER_VISIBILITY_ALL;
rootParam.Descriptor = CD3DX12_ROOT_DESCRIPTOR(0, 0);
```

2. 定义静态和动态描述符

静态描述符（Static Descriptor）是指预先创建的描述符堆，包含所有可能使用到的描述符。动态描述符（Dynamic Descriptor）则是在运行时动态创建的描述符，通常用于处理大批量不同的对象。

可以使用 D3D12_DESCRIPTOR_RANGE 结构体来定义静态和动态描述符，其中包含如下字段：

- RangeType：指定描述符范围的类型，包括 CBV、SRV、UAV 和 着色器资源堆（Sampler Heap）等。
- NumDescriptors：指定描述符的数量。
- BaseShaderRegister：指定与描述符相关联的着色器程序寄存器名称的起始值。
- RegisterSpace：指定着色器程序寄存器名称的空间值，通常为 0。
- OffsetInDescriptorsFromTableStart：指定描述符相对于描述符表起始地址的偏移量，通常为 0。

例如，下面的代码定义了两个静态描述符，分别表示一个常量缓冲区和一个着色器资源视图：

```c++
// 定义静态描述符范围数组
D3D12_DESCRIPTOR_RANGE descRanges[2] = {};

// 第一个描述符范围
descRanges[0].RangeType = D3D12_DESCRIPTOR_RANGE_TYPE_CBV;
descRanges[0].NumDescriptors = 1;
descRanges[0].BaseShader